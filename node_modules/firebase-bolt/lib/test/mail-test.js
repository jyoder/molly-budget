"use strict";
/*
 * Copyright 2015 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var simulator_1 = require('../simulator');
var secrets = require('../../auth-secrets');
simulator_1.rulesSuite("Mail", function (test) {
    var uid = test.uid;
    test.database(secrets.APP, secrets.SECRET);
    test.rules('samples/mail');
    test("Inbox tests.", function (rules) {
        rules
            .as('tom')
            .at('/users/' + uid('bill') + '/inbox/1')
            .write({
            from: uid('tom'),
            to: uid('bill'),
            message: 'Hi, Bill!'
        })
            .succeeds("Normal write.")
            .write(null)
            .fails("Sender cannot delete sent message.")
            .write({
            from: uid('tom'),
            to: uid('bill'),
            message: 'Hello, again!'
        })
            .fails("Sender cannot overwrite.")
            .at('/users/' + uid('bill') + '/inbox/2')
            .write({
            from: uid('tom'),
            to: uid('bill'),
            message: 'Hi, Bill!',
            spurious: 'supurious data'
        })
            .fails("No undefined fields.")
            .write({
            from: uid('george'),
            to: uid('bill'),
            message: 'Hi, Bill!'
        })
            .fails("From field should be correct.")
            .at('/users/' + uid('bill') + '/inbox/1/message')
            .write("Bill gets my inheritance")
            .fails("Cannnot tamper with message.")
            .at('/users/' + uid('bill') + '/inbox/1/from')
            .write(uid('bill'))
            .fails("Cannot tamper with from field.")
            .as('bill')
            .at('/users/' + uid('bill') + '/inbox/1')
            .write(null)
            .succeeds("Receiver can delete received mail.");
    });
    test("Outbox tests.", function (rules) {
        rules
            .as('bill')
            .at('/users/' + uid('bill') + '/outbox/1')
            .write({
            from: uid('bill'),
            to: uid('tom'),
            message: "Hi, Tom!"
        })
            .succeeds("Normal write.")
            .as('tom')
            .write(null)
            .fails("Receiver cannot delete outbox message.")
            .as('bill')
            .at('/users/' + uid('bill') + '/outbox/1/message')
            .write("Bill gets my inheritance.")
            .fails("Sender cannot tamper with outbox message.")
            .at('/users/' + uid('bill') + '/outbox/1/from')
            .write('bill')
            .fails("Can't do a partial overwrite - even if same data.")
            .as('bill')
            .at('/users/' + uid('bill') + '/outbox/2')
            .write({
            from: 'joe',
            to: 'tom',
            message: "Hi, Tom!"
        })
            .fails("From field must be correct.")
            .write({
            from: 'bill',
            to: 'tom',
            message: "Hi, Tom!",
            spurious: "spurious"
        })
            .fails("No undefined fields.")
            .at('/users/' + uid('bill') + '/outbox/1')
            .write(null)
            .succeeds("Sender can delete sent mail in outbox.");
    });
    test("Read permissions.", function (rules) {
        rules
            .as('bill')
            .at('/users/' + uid('bill') + '/outbox/1')
            .write({
            from: uid('bill'),
            to: uid('tom'),
            message: 'Hi, Tom!'
        })
            .succeeds("Normal write.")
            .as('tom')
            .at('/users/' + uid('bill') + '/inbox/1')
            .write({
            from: uid('tom'),
            to: uid('bill'),
            message: 'Hi, Bill!'
        })
            .as('bill')
            .at('/users/' + uid('bill') + '/inbox/1')
            .read()
            .succeeds("Can read own inbox.")
            .at('/users/' + uid('bill') + '/outbox/1')
            .read()
            .succeeds("Can read own outbox.")
            .as('tom')
            .at('/users/' + uid('bill') + '/inbox/1')
            .read()
            .fails("Can't read Bill's inbox.")
            .at('/users/' + uid('bill') + '/outbox/1')
            .read()
            .fails("Can't read Bills outbox.");
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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VyxDQUFDO2FBQ3pDLElBQUksRUFBRTthQUNOLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9tYWlsLXRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IDIwMTUgR29vZ2xlIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7cnVsZXNTdWl0ZX0gZnJvbSAnLi4vc2ltdWxhdG9yJztcbnZhciBzZWNyZXRzID0gcmVxdWlyZSgnLi4vLi4vYXV0aC1zZWNyZXRzJyk7XG5cbnJ1bGVzU3VpdGUoXCJNYWlsXCIsIGZ1bmN0aW9uKHRlc3QpIHtcbiAgdmFyIHVpZCA9IHRlc3QudWlkO1xuXG4gIHRlc3QuZGF0YWJhc2Uoc2VjcmV0cy5BUFAsIHNlY3JldHMuU0VDUkVUKTtcbiAgdGVzdC5ydWxlcygnc2FtcGxlcy9tYWlsJyk7XG5cbiAgdGVzdChcIkluYm94IHRlc3RzLlwiLCBmdW5jdGlvbihydWxlcykge1xuICAgIHJ1bGVzXG4gICAgICAuYXMoJ3RvbScpXG4gICAgICAuYXQoJy91c2Vycy8nICsgdWlkKCdiaWxsJykgKyAnL2luYm94LzEnKVxuICAgICAgLndyaXRlKHtcbiAgICAgICAgZnJvbTogdWlkKCd0b20nKSxcbiAgICAgICAgdG86IHVpZCgnYmlsbCcpLFxuICAgICAgICBtZXNzYWdlOiAnSGksIEJpbGwhJ1xuICAgICAgfSlcbiAgICAgIC5zdWNjZWVkcyhcIk5vcm1hbCB3cml0ZS5cIilcblxuICAgICAgLndyaXRlKG51bGwpXG4gICAgICAuZmFpbHMoXCJTZW5kZXIgY2Fubm90IGRlbGV0ZSBzZW50IG1lc3NhZ2UuXCIpXG5cbiAgICAgIC53cml0ZSh7XG4gICAgICAgIGZyb206IHVpZCgndG9tJyksXG4gICAgICAgIHRvOiB1aWQoJ2JpbGwnKSxcbiAgICAgICAgbWVzc2FnZTogJ0hlbGxvLCBhZ2FpbiEnXG4gICAgICB9KVxuICAgICAgLmZhaWxzKFwiU2VuZGVyIGNhbm5vdCBvdmVyd3JpdGUuXCIpXG5cbiAgICAgIC5hdCgnL3VzZXJzLycgKyB1aWQoJ2JpbGwnKSArICcvaW5ib3gvMicpXG4gICAgICAud3JpdGUoe1xuICAgICAgICBmcm9tOiB1aWQoJ3RvbScpLFxuICAgICAgICB0bzogdWlkKCdiaWxsJyksXG4gICAgICAgIG1lc3NhZ2U6ICdIaSwgQmlsbCEnLFxuICAgICAgICBzcHVyaW91czogJ3N1cHVyaW91cyBkYXRhJ1xuICAgICAgfSlcbiAgICAgIC5mYWlscyhcIk5vIHVuZGVmaW5lZCBmaWVsZHMuXCIpXG5cbiAgICAgIC53cml0ZSh7XG4gICAgICAgIGZyb206IHVpZCgnZ2VvcmdlJyksXG4gICAgICAgIHRvOiB1aWQoJ2JpbGwnKSxcbiAgICAgICAgbWVzc2FnZTogJ0hpLCBCaWxsISdcbiAgICAgIH0pXG4gICAgICAuZmFpbHMoXCJGcm9tIGZpZWxkIHNob3VsZCBiZSBjb3JyZWN0LlwiKVxuXG4gICAgICAuYXQoJy91c2Vycy8nICsgdWlkKCdiaWxsJykgKyAnL2luYm94LzEvbWVzc2FnZScpXG4gICAgICAud3JpdGUoXCJCaWxsIGdldHMgbXkgaW5oZXJpdGFuY2VcIilcbiAgICAgIC5mYWlscyhcIkNhbm5ub3QgdGFtcGVyIHdpdGggbWVzc2FnZS5cIilcblxuICAgICAgLmF0KCcvdXNlcnMvJyArIHVpZCgnYmlsbCcpICsgJy9pbmJveC8xL2Zyb20nKVxuICAgICAgLndyaXRlKHVpZCgnYmlsbCcpKVxuICAgICAgLmZhaWxzKFwiQ2Fubm90IHRhbXBlciB3aXRoIGZyb20gZmllbGQuXCIpXG5cbiAgICAgIC5hcygnYmlsbCcpXG4gICAgICAuYXQoJy91c2Vycy8nICsgdWlkKCdiaWxsJykgKyAnL2luYm94LzEnKVxuICAgICAgLndyaXRlKG51bGwpXG4gICAgICAuc3VjY2VlZHMoXCJSZWNlaXZlciBjYW4gZGVsZXRlIHJlY2VpdmVkIG1haWwuXCIpO1xuICB9KTtcblxuXG4gIHRlc3QoXCJPdXRib3ggdGVzdHMuXCIsIGZ1bmN0aW9uKHJ1bGVzKSB7XG4gICAgcnVsZXNcbiAgICAgIC5hcygnYmlsbCcpXG4gICAgICAuYXQoJy91c2Vycy8nICsgdWlkKCdiaWxsJykgKyAnL291dGJveC8xJylcbiAgICAgIC53cml0ZSh7XG4gICAgICAgIGZyb206IHVpZCgnYmlsbCcpLFxuICAgICAgICB0bzogdWlkKCd0b20nKSxcbiAgICAgICAgbWVzc2FnZTogXCJIaSwgVG9tIVwiXG4gICAgICB9KVxuICAgICAgLnN1Y2NlZWRzKFwiTm9ybWFsIHdyaXRlLlwiKVxuXG4gICAgICAuYXMoJ3RvbScpXG4gICAgICAud3JpdGUobnVsbClcbiAgICAgIC5mYWlscyhcIlJlY2VpdmVyIGNhbm5vdCBkZWxldGUgb3V0Ym94IG1lc3NhZ2UuXCIpXG5cbiAgICAgIC5hcygnYmlsbCcpXG5cbiAgICAgIC5hdCgnL3VzZXJzLycgKyB1aWQoJ2JpbGwnKSArICcvb3V0Ym94LzEvbWVzc2FnZScpXG4gICAgICAud3JpdGUoXCJCaWxsIGdldHMgbXkgaW5oZXJpdGFuY2UuXCIpXG4gICAgICAuZmFpbHMoXCJTZW5kZXIgY2Fubm90IHRhbXBlciB3aXRoIG91dGJveCBtZXNzYWdlLlwiKVxuXG4gICAgICAuYXQoJy91c2Vycy8nICsgdWlkKCdiaWxsJykgKyAnL291dGJveC8xL2Zyb20nKVxuICAgICAgLndyaXRlKCdiaWxsJylcbiAgICAgIC5mYWlscyhcIkNhbid0IGRvIGEgcGFydGlhbCBvdmVyd3JpdGUgLSBldmVuIGlmIHNhbWUgZGF0YS5cIilcblxuICAgICAgLmFzKCdiaWxsJylcbiAgICAgIC5hdCgnL3VzZXJzLycgKyB1aWQoJ2JpbGwnKSArICcvb3V0Ym94LzInKVxuICAgICAgLndyaXRlKHtcbiAgICAgICAgZnJvbTogJ2pvZScsXG4gICAgICAgIHRvOiAndG9tJyxcbiAgICAgICAgbWVzc2FnZTogXCJIaSwgVG9tIVwiXG4gICAgICB9KVxuICAgICAgLmZhaWxzKFwiRnJvbSBmaWVsZCBtdXN0IGJlIGNvcnJlY3QuXCIpXG5cbiAgICAgIC53cml0ZSh7XG4gICAgICAgIGZyb206ICdiaWxsJyxcbiAgICAgICAgdG86ICd0b20nLFxuICAgICAgICBtZXNzYWdlOiBcIkhpLCBUb20hXCIsXG4gICAgICAgIHNwdXJpb3VzOiBcInNwdXJpb3VzXCJcbiAgICAgIH0pXG4gICAgICAuZmFpbHMoXCJObyB1bmRlZmluZWQgZmllbGRzLlwiKVxuXG4gICAgICAuYXQoJy91c2Vycy8nICsgdWlkKCdiaWxsJykgKyAnL291dGJveC8xJylcbiAgICAgIC53cml0ZShudWxsKVxuICAgICAgLnN1Y2NlZWRzKFwiU2VuZGVyIGNhbiBkZWxldGUgc2VudCBtYWlsIGluIG91dGJveC5cIik7XG4gIH0pO1xuXG4gIHRlc3QoXCJSZWFkIHBlcm1pc3Npb25zLlwiLCBmdW5jdGlvbihydWxlcykge1xuICAgIHJ1bGVzXG4gICAgICAuYXMoJ2JpbGwnKVxuICAgICAgLmF0KCcvdXNlcnMvJyArIHVpZCgnYmlsbCcpICsgJy9vdXRib3gvMScpXG4gICAgICAud3JpdGUoe1xuICAgICAgICBmcm9tOiB1aWQoJ2JpbGwnKSxcbiAgICAgICAgdG86IHVpZCgndG9tJyksXG4gICAgICAgIG1lc3NhZ2U6ICdIaSwgVG9tISdcbiAgICAgIH0pXG4gICAgICAuc3VjY2VlZHMoXCJOb3JtYWwgd3JpdGUuXCIpXG5cbiAgICAgIC5hcygndG9tJylcbiAgICAgIC5hdCgnL3VzZXJzLycgKyB1aWQoJ2JpbGwnKSArICcvaW5ib3gvMScpXG4gICAgICAud3JpdGUoe1xuICAgICAgICBmcm9tOiB1aWQoJ3RvbScpLFxuICAgICAgICB0bzogdWlkKCdiaWxsJyksXG4gICAgICAgIG1lc3NhZ2U6ICdIaSwgQmlsbCEnXG4gICAgICB9KVxuXG4gICAgICAuYXMoJ2JpbGwnKVxuICAgICAgLmF0KCcvdXNlcnMvJyArIHVpZCgnYmlsbCcpICsgJy9pbmJveC8xJylcbiAgICAgIC5yZWFkKClcbiAgICAgIC5zdWNjZWVkcyhcIkNhbiByZWFkIG93biBpbmJveC5cIilcblxuICAgICAgLmF0KCcvdXNlcnMvJyArIHVpZCgnYmlsbCcpICsgJy9vdXRib3gvMScpXG4gICAgICAucmVhZCgpXG4gICAgICAuc3VjY2VlZHMoXCJDYW4gcmVhZCBvd24gb3V0Ym94LlwiKVxuXG4gICAgICAuYXMoJ3RvbScpXG4gICAgICAuYXQoJy91c2Vycy8nICsgdWlkKCdiaWxsJykgKyAnL2luYm94LzEnKVxuICAgICAgLnJlYWQoKVxuICAgICAgLmZhaWxzKFwiQ2FuJ3QgcmVhZCBCaWxsJ3MgaW5ib3guXCIpXG5cbiAgICAgIC5hdCgnL3VzZXJzLycgKyB1aWQoJ2JpbGwnKSArICcvb3V0Ym94LzEnKVxuICAgICAgLnJlYWQoKVxuICAgICAgLmZhaWxzKFwiQ2FuJ3QgcmVhZCBCaWxscyBvdXRib3guXCIpO1xuICB9KTtcbn0pO1xuIl19
