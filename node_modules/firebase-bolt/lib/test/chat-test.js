"use strict";
/*
 * Copyright 2015 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var simulator_1 = require('../simulator');
var secrets = require('../../auth-secrets');
simulator_1.rulesSuite("Chat", function (test) {
    var uid = test.uid;
    test.database(secrets.APP, secrets.SECRET);
    test.rules('samples/chat');
    function makeMikesRoom(rules) {
        return rules
            .as('mike')
            .at('/rooms/mikes-room')
            .write({
            name: "Mike's room",
            creator: uid('mike')
        });
    }
    test("Create and Delete Room.", function (rules) {
        makeMikesRoom(rules)
            .succeeds("Create empty room.")
            .as('fred')
            .write(null)
            .fails("Non-owner cannot delete room.")
            .as('mike')
            .write(null)
            .succeeds("Owner can delete room.");
    });
    test("Forge Creator of Room.", function (rules) {
        rules
            .as('mike')
            .at('/rooms/mikes-room')
            .write({
            name: "Mike's room",
            creator: uid('fred')
        })
            .fails("Can't create forged room.");
    });
    test("Join a Room.", function (rules) {
        makeMikesRoom(rules)
            .at('/rooms/mikes-room/members/' + uid('mike'))
            .write({
            nickname: 'Mike',
            isBanned: false
        })
            .succeeds("Add self to room members.")
            .at('/rooms/mikes-room/members/' + uid('fred'))
            .write({
            nickname: 'Fred',
            isBanned: false
        })
            .succeeds("Creator can add other members.")
            .as('barney')
            .at('/rooms/mikes-room/members/' + uid('barney'))
            .write({
            nickname: 'Barney',
            isBanned: false
        })
            .succeeds("User can add self to a room.")
            .as('mike')
            .at('/rooms/mikes-room/members/' + uid('fred'))
            .write(null)
            .succeeds("Creator can remove a member.");
    });
    test("Banning and unbanning.", function (rules) {
        makeMikesRoom(rules)
            .at('/rooms/mikes-room/members/' + uid('mike'))
            .as('barney')
            .at('/rooms/mikes-room/members/' + uid('barney'))
            .write({
            nickname: 'Barney',
            isBanned: false
        })
            .succeeds("User can add self to a room.")
            .as('mike')
            .at('/rooms/mikes-room/members/' + uid('barney') + '/isBanned')
            .write(true)
            .succeeds("Creator can ban a member.")
            .as('barney')
            .at('/rooms/mikes-room/members/' + uid('barney'))
            .write(null)
            .fails("User tries to delete self.")
            .as('barney')
            .at('/rooms/mikes-room/members/' + uid('barney'))
            .write({
            nickname: 'Barney',
            isBanned: false
        })
            .fails("User tries to rejoin")
            .as('barney')
            .at('/rooms/mikes-room/members/' + uid('barney') + '/isBanned')
            .write(false)
            .fails("User tries to unban self.")
            .as('mike')
            .at('/rooms/mikes-room/members/' + uid('barney') + '/isBanned')
            .write(false)
            .succeeds("Room creator can unban user.");
    });
    test("Posting.", function (rules) {
        makeMikesRoom(rules)
            .at('/posts/mikes-room')
            .push({
            from: uid('mike'),
            message: "Hello, world!",
            created: test.TIMESTAMP
        })
            .fails("Owner can't write into room until he is a member.")
            .at('/rooms/mikes-room/members/' + uid('mike'))
            .write({
            nickname: 'Mike',
            isBanned: false
        })
            .succeeds("Add self to room members.")
            .at('/posts/mikes-room')
            .push({
            from: uid('mike'),
            message: "Hello, world!",
            created: test.TIMESTAMP
        })
            .succeeds("Owner-member can post to room.")
            .as('barney')
            .at('/posts/mikes-room')
            .push({
            from: uid('barney'),
            message: "Hello, Mike!",
            created: test.TIMESTAMP
        })
            .fails("Non-members cannot post.")
            .as('barney')
            .at('/rooms/mikes-room/members/' + uid('barney'))
            .write({
            nickname: 'Barney',
            isBanned: false
        })
            .succeeds("User can add self to a room.")
            .as('barney')
            .at('/posts/mikes-room')
            .push({
            from: uid('barney'),
            message: "Hello, Mike!",
            created: test.TIMESTAMP
        })
            .succeeds("Members can post.")
            .as('mike')
            .at('/rooms/mikes-room/members/' + uid('barney') + '/isBanned')
            .write(true)
            .succeeds("Creator can ban a member.")
            .as('barney')
            .at('/posts/mikes-room')
            .push({
            from: uid('barney'),
            message: "Hello, Mike!",
            created: test.TIMESTAMP
        })
            .fails("Banned members cannot post.");
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDO2FBQ2hELEtBQUssQ0FBQztZQUNMLFFBQVEsRUFBRSxRQUFRO1lBQ2xCLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUM7YUFDRCxRQUFRLENBQUMsOEJBQThCLENBQUM7YUFFeEMsRUFBRSxDQUFDLFFBQVEsQ0FBQzthQUNaLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQzthQUN2QixJQUFJLENBQUM7WUFDSixJQUFJLEVBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBQztZQUNuQixPQUFPLEVBQUUsY0FBYztZQUN2QixPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVM7U0FDeEIsQ0FBQzthQUNELFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQzthQUU3QixFQUFFLENBQUMsTUFBTSxDQUFDO2FBQ1YsRUFBRSxDQUFDLDRCQUE0QixHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxXQUFXLENBQUM7YUFDOUQsS0FBSyxDQUFDLElBQUksQ0FBQzthQUNYLFFBQVEsQ0FBQywyQkFBMkIsQ0FBQzthQUVyQyxFQUFFLENBQUMsUUFBUSxDQUFDO2FBQ1osRUFBRSxDQUFDLG1CQUFtQixDQUFDO2FBQ3ZCLElBQUksQ0FBQztZQUNKLElBQUksRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDO1lBQ25CLE9BQU8sRUFBRSxjQUFjO1lBQ3ZCLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUztTQUN4QixDQUFDO2FBQ0QsS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQ3RDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2NoYXQtdGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgMjAxNSBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHtydWxlc1N1aXRlLCBSdWxlc1Rlc3R9IGZyb20gJy4uL3NpbXVsYXRvcic7XG5sZXQgc2VjcmV0cyA9IHJlcXVpcmUoJy4uLy4uL2F1dGgtc2VjcmV0cycpO1xuXG5ydWxlc1N1aXRlKFwiQ2hhdFwiLCBmdW5jdGlvbih0ZXN0KSB7XG4gIHZhciB1aWQgPSB0ZXN0LnVpZDtcblxuICB0ZXN0LmRhdGFiYXNlKHNlY3JldHMuQVBQLCBzZWNyZXRzLlNFQ1JFVCk7XG4gIHRlc3QucnVsZXMoJ3NhbXBsZXMvY2hhdCcpO1xuXG4gIGZ1bmN0aW9uIG1ha2VNaWtlc1Jvb20ocnVsZXM6IFJ1bGVzVGVzdCk6IFJ1bGVzVGVzdCB7XG4gICAgcmV0dXJuIHJ1bGVzXG4gICAgICAuYXMoJ21pa2UnKVxuICAgICAgLmF0KCcvcm9vbXMvbWlrZXMtcm9vbScpXG4gICAgICAud3JpdGUoe1xuICAgICAgICBuYW1lOiBcIk1pa2UncyByb29tXCIsXG4gICAgICAgIGNyZWF0b3I6IHVpZCgnbWlrZScpLFxuICAgICAgfSk7XG4gIH1cblxuICB0ZXN0KFwiQ3JlYXRlIGFuZCBEZWxldGUgUm9vbS5cIiwgZnVuY3Rpb24ocnVsZXMpIHtcbiAgICBtYWtlTWlrZXNSb29tKHJ1bGVzKVxuICAgICAgLnN1Y2NlZWRzKFwiQ3JlYXRlIGVtcHR5IHJvb20uXCIpXG5cbiAgICAgIC5hcygnZnJlZCcpXG4gICAgICAud3JpdGUobnVsbClcbiAgICAgIC5mYWlscyhcIk5vbi1vd25lciBjYW5ub3QgZGVsZXRlIHJvb20uXCIpXG5cbiAgICAgIC5hcygnbWlrZScpXG4gICAgICAud3JpdGUobnVsbClcbiAgICAgIC5zdWNjZWVkcyhcIk93bmVyIGNhbiBkZWxldGUgcm9vbS5cIilcbiAgICA7XG4gIH0pO1xuXG4gIHRlc3QoXCJGb3JnZSBDcmVhdG9yIG9mIFJvb20uXCIsIGZ1bmN0aW9uKHJ1bGVzKSB7XG4gICAgcnVsZXNcbiAgICAgIC5hcygnbWlrZScpXG4gICAgICAuYXQoJy9yb29tcy9taWtlcy1yb29tJylcbiAgICAgIC53cml0ZSh7XG4gICAgICAgIG5hbWU6IFwiTWlrZSdzIHJvb21cIixcbiAgICAgICAgY3JlYXRvcjogdWlkKCdmcmVkJyksXG4gICAgICB9KVxuICAgICAgLmZhaWxzKFwiQ2FuJ3QgY3JlYXRlIGZvcmdlZCByb29tLlwiKTtcbiAgfSk7XG5cbiAgdGVzdChcIkpvaW4gYSBSb29tLlwiLCBmdW5jdGlvbihydWxlcykge1xuICAgIG1ha2VNaWtlc1Jvb20ocnVsZXMpXG4gICAgICAuYXQoJy9yb29tcy9taWtlcy1yb29tL21lbWJlcnMvJyArIHVpZCgnbWlrZScpKVxuICAgICAgLndyaXRlKHtcbiAgICAgICAgbmlja25hbWU6ICdNaWtlJyxcbiAgICAgICAgaXNCYW5uZWQ6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLnN1Y2NlZWRzKFwiQWRkIHNlbGYgdG8gcm9vbSBtZW1iZXJzLlwiKVxuXG4gICAgICAuYXQoJy9yb29tcy9taWtlcy1yb29tL21lbWJlcnMvJyArIHVpZCgnZnJlZCcpKVxuICAgICAgLndyaXRlKHtcbiAgICAgICAgbmlja25hbWU6ICdGcmVkJyxcbiAgICAgICAgaXNCYW5uZWQ6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLnN1Y2NlZWRzKFwiQ3JlYXRvciBjYW4gYWRkIG90aGVyIG1lbWJlcnMuXCIpXG5cbiAgICAgIC5hcygnYmFybmV5JylcbiAgICAgIC5hdCgnL3Jvb21zL21pa2VzLXJvb20vbWVtYmVycy8nICsgdWlkKCdiYXJuZXknKSlcbiAgICAgIC53cml0ZSh7XG4gICAgICAgIG5pY2tuYW1lOiAnQmFybmV5JyxcbiAgICAgICAgaXNCYW5uZWQ6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLnN1Y2NlZWRzKFwiVXNlciBjYW4gYWRkIHNlbGYgdG8gYSByb29tLlwiKVxuXG4gICAgICAuYXMoJ21pa2UnKVxuICAgICAgLmF0KCcvcm9vbXMvbWlrZXMtcm9vbS9tZW1iZXJzLycgKyB1aWQoJ2ZyZWQnKSlcbiAgICAgIC53cml0ZShudWxsKVxuICAgICAgLnN1Y2NlZWRzKFwiQ3JlYXRvciBjYW4gcmVtb3ZlIGEgbWVtYmVyLlwiKVxuICAgIDtcbiAgfSk7XG5cbiAgdGVzdChcIkJhbm5pbmcgYW5kIHVuYmFubmluZy5cIiwgZnVuY3Rpb24ocnVsZXMpIHtcbiAgICBtYWtlTWlrZXNSb29tKHJ1bGVzKVxuICAgICAgLmF0KCcvcm9vbXMvbWlrZXMtcm9vbS9tZW1iZXJzLycgKyB1aWQoJ21pa2UnKSlcblxuICAgICAgLmFzKCdiYXJuZXknKVxuICAgICAgLmF0KCcvcm9vbXMvbWlrZXMtcm9vbS9tZW1iZXJzLycgKyB1aWQoJ2Jhcm5leScpKVxuICAgICAgLndyaXRlKHtcbiAgICAgICAgbmlja25hbWU6ICdCYXJuZXknLFxuICAgICAgICBpc0Jhbm5lZDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAuc3VjY2VlZHMoXCJVc2VyIGNhbiBhZGQgc2VsZiB0byBhIHJvb20uXCIpXG5cbiAgICAgIC5hcygnbWlrZScpXG4gICAgICAuYXQoJy9yb29tcy9taWtlcy1yb29tL21lbWJlcnMvJyArIHVpZCgnYmFybmV5JykgKyAnL2lzQmFubmVkJylcbiAgICAgIC53cml0ZSh0cnVlKVxuICAgICAgLnN1Y2NlZWRzKFwiQ3JlYXRvciBjYW4gYmFuIGEgbWVtYmVyLlwiKVxuXG4gICAgICAuYXMoJ2Jhcm5leScpXG4gICAgICAuYXQoJy9yb29tcy9taWtlcy1yb29tL21lbWJlcnMvJyArIHVpZCgnYmFybmV5JykpXG4gICAgICAud3JpdGUobnVsbClcbiAgICAgIC5mYWlscyhcIlVzZXIgdHJpZXMgdG8gZGVsZXRlIHNlbGYuXCIpXG5cbiAgICAgIC5hcygnYmFybmV5JylcbiAgICAgIC5hdCgnL3Jvb21zL21pa2VzLXJvb20vbWVtYmVycy8nICsgdWlkKCdiYXJuZXknKSlcbiAgICAgIC53cml0ZSh7XG4gICAgICAgIG5pY2tuYW1lOiAnQmFybmV5JyxcbiAgICAgICAgaXNCYW5uZWQ6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLmZhaWxzKFwiVXNlciB0cmllcyB0byByZWpvaW5cIilcblxuICAgICAgLmFzKCdiYXJuZXknKVxuICAgICAgLmF0KCcvcm9vbXMvbWlrZXMtcm9vbS9tZW1iZXJzLycgKyB1aWQoJ2Jhcm5leScpICsgJy9pc0Jhbm5lZCcpXG4gICAgICAud3JpdGUoZmFsc2UpXG4gICAgICAuZmFpbHMoXCJVc2VyIHRyaWVzIHRvIHVuYmFuIHNlbGYuXCIpXG5cbiAgICAgIC5hcygnbWlrZScpXG4gICAgICAuYXQoJy9yb29tcy9taWtlcy1yb29tL21lbWJlcnMvJyArIHVpZCgnYmFybmV5JykgKyAnL2lzQmFubmVkJylcbiAgICAgIC53cml0ZShmYWxzZSlcbiAgICAgIC5zdWNjZWVkcyhcIlJvb20gY3JlYXRvciBjYW4gdW5iYW4gdXNlci5cIilcbiAgICA7XG4gIH0pO1xuXG4gIHRlc3QoXCJQb3N0aW5nLlwiLCBmdW5jdGlvbihydWxlcykge1xuICAgIG1ha2VNaWtlc1Jvb20ocnVsZXMpXG4gICAgICAuYXQoJy9wb3N0cy9taWtlcy1yb29tJylcbiAgICAgIC5wdXNoKHtcbiAgICAgICAgZnJvbTogdWlkKCdtaWtlJyksXG4gICAgICAgIG1lc3NhZ2U6IFwiSGVsbG8sIHdvcmxkIVwiLFxuICAgICAgICBjcmVhdGVkOiB0ZXN0LlRJTUVTVEFNUCxcbiAgICAgIH0pXG4gICAgICAuZmFpbHMoXCJPd25lciBjYW4ndCB3cml0ZSBpbnRvIHJvb20gdW50aWwgaGUgaXMgYSBtZW1iZXIuXCIpXG5cbiAgICAgIC5hdCgnL3Jvb21zL21pa2VzLXJvb20vbWVtYmVycy8nICsgdWlkKCdtaWtlJykpXG4gICAgICAud3JpdGUoe1xuICAgICAgICBuaWNrbmFtZTogJ01pa2UnLFxuICAgICAgICBpc0Jhbm5lZDogZmFsc2VcbiAgICAgIH0pXG4gICAgICAuc3VjY2VlZHMoXCJBZGQgc2VsZiB0byByb29tIG1lbWJlcnMuXCIpXG5cbiAgICAgIC5hdCgnL3Bvc3RzL21pa2VzLXJvb20nKVxuICAgICAgLnB1c2goe1xuICAgICAgICBmcm9tOiB1aWQoJ21pa2UnKSxcbiAgICAgICAgbWVzc2FnZTogXCJIZWxsbywgd29ybGQhXCIsXG4gICAgICAgIGNyZWF0ZWQ6IHRlc3QuVElNRVNUQU1QLFxuICAgICAgfSlcbiAgICAgIC5zdWNjZWVkcyhcIk93bmVyLW1lbWJlciBjYW4gcG9zdCB0byByb29tLlwiKVxuXG4gICAgICAuYXMoJ2Jhcm5leScpXG4gICAgICAuYXQoJy9wb3N0cy9taWtlcy1yb29tJylcbiAgICAgIC5wdXNoKHtcbiAgICAgICAgZnJvbTogdWlkKCdiYXJuZXknKSxcbiAgICAgICAgbWVzc2FnZTogXCJIZWxsbywgTWlrZSFcIixcbiAgICAgICAgY3JlYXRlZDogdGVzdC5USU1FU1RBTVAsXG4gICAgICB9KVxuICAgICAgLmZhaWxzKFwiTm9uLW1lbWJlcnMgY2Fubm90IHBvc3QuXCIpXG5cbiAgICAgIC5hcygnYmFybmV5JylcbiAgICAgIC5hdCgnL3Jvb21zL21pa2VzLXJvb20vbWVtYmVycy8nICsgdWlkKCdiYXJuZXknKSlcbiAgICAgIC53cml0ZSh7XG4gICAgICAgIG5pY2tuYW1lOiAnQmFybmV5JyxcbiAgICAgICAgaXNCYW5uZWQ6IGZhbHNlXG4gICAgICB9KVxuICAgICAgLnN1Y2NlZWRzKFwiVXNlciBjYW4gYWRkIHNlbGYgdG8gYSByb29tLlwiKVxuXG4gICAgICAuYXMoJ2Jhcm5leScpXG4gICAgICAuYXQoJy9wb3N0cy9taWtlcy1yb29tJylcbiAgICAgIC5wdXNoKHtcbiAgICAgICAgZnJvbTogdWlkKCdiYXJuZXknKSxcbiAgICAgICAgbWVzc2FnZTogXCJIZWxsbywgTWlrZSFcIixcbiAgICAgICAgY3JlYXRlZDogdGVzdC5USU1FU1RBTVAsXG4gICAgICB9KVxuICAgICAgLnN1Y2NlZWRzKFwiTWVtYmVycyBjYW4gcG9zdC5cIilcblxuICAgICAgLmFzKCdtaWtlJylcbiAgICAgIC5hdCgnL3Jvb21zL21pa2VzLXJvb20vbWVtYmVycy8nICsgdWlkKCdiYXJuZXknKSArICcvaXNCYW5uZWQnKVxuICAgICAgLndyaXRlKHRydWUpXG4gICAgICAuc3VjY2VlZHMoXCJDcmVhdG9yIGNhbiBiYW4gYSBtZW1iZXIuXCIpXG5cbiAgICAgIC5hcygnYmFybmV5JylcbiAgICAgIC5hdCgnL3Bvc3RzL21pa2VzLXJvb20nKVxuICAgICAgLnB1c2goe1xuICAgICAgICBmcm9tOiB1aWQoJ2Jhcm5leScpLFxuICAgICAgICBtZXNzYWdlOiBcIkhlbGxvLCBNaWtlIVwiLFxuICAgICAgICBjcmVhdGVkOiB0ZXN0LlRJTUVTVEFNUCxcbiAgICAgIH0pXG4gICAgICAuZmFpbHMoXCJCYW5uZWQgbWVtYmVycyBjYW5ub3QgcG9zdC5cIilcbiAgICA7XG4gIH0pO1xufSk7XG4iXX0=
